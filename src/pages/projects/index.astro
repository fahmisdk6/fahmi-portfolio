---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const allProjects = (await getCollection("projects")).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime()
);

const categories = ["professional", "personal", "open-source"] as const;

const grouped = Object.fromEntries(
  categories.map((cat) => [cat, allProjects.filter((p) => p.data.category === cat)])
);

const categoryLabels: Record<string, string> = {
  professional: "Professional",
  personal: "Personal",
  "open-source": "Open Source",
};
---

<BaseLayout title="Projects â€” Fahmi Sidik">
  <section class="py-8">
    <h1 class="text-4xl font-bold mb-4">Projects</h1>
    <p class="text-text-muted text-lg max-w-2xl">
      A collection of work across professional, personal, and open source projects.
    </p>
  </section>

  {categories.map((cat) =>
    grouped[cat].length > 0 && (
      <section class="py-10">
        <h2 class="text-xl font-semibold mb-6 flex items-center gap-3">
          <span class="w-3 h-3 rounded-full bg-primary"></span>
          {categoryLabels[cat]}
        </h2>
        <div class="grid md:grid-cols-2 gap-6">
          {grouped[cat].map((project) => (
            <a
              href={`/projects/${project.id}`}
              class="group block p-6 rounded-xl border border-white/5 bg-surface-light hover:border-primary/30 transition-all"
            >
              <h3 class="text-lg font-semibold group-hover:text-primary transition-colors">
                {project.data.title}
              </h3>
              <p class="text-text-muted text-sm mt-2 line-clamp-2">
                {project.data.description}
              </p>
              <div class="flex flex-wrap gap-2 mt-4">
                {project.data.tech.map((t) => (
                  <span class="text-xs px-2 py-1 rounded bg-white/5 text-text-muted">
                    {t}
                  </span>
                ))}
              </div>
              <div class="flex items-center gap-4 mt-4 text-xs text-text-muted">
                <time datetime={project.data.date.toISOString()}>
                  {project.data.date.toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "short",
                  })}
                </time>
                {project.data.url && <span>Live &nearr;</span>}
                {project.data.repo && <span>Source &nearr;</span>}
              </div>
            </a>
          ))}
        </div>
      </section>
    )
  )}
</BaseLayout>
