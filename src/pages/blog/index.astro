---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog"))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const allTags = [...new Set(posts.flatMap((p) => p.data.tags))].sort();
---

<BaseLayout title="Blog â€” Fahmi Sidik">
  <section class="py-8">
    <h1 class="text-4xl font-bold mb-4">Blog</h1>
    <p class="text-text-muted text-lg max-w-2xl">
      Thoughts on mobile development, architecture, and engineering.
    </p>
  </section>

  {allTags.length > 0 && (
    <div class="flex flex-wrap gap-2 mb-10">
      {allTags.map((tag) => (
        <span class="text-xs px-3 py-1 rounded-full border border-white/10 text-text-muted hover:border-primary/30 hover:text-primary cursor-default transition-colors">
          {tag}
        </span>
      ))}
    </div>
  )}

  <div class="space-y-6 pb-10">
    {posts.map((post) => (
      <a
        href={`/blog/${post.id}`}
        class="group block p-6 rounded-xl border border-white/5 bg-surface-light hover:border-primary/30 transition-all"
      >
        <div class="flex items-center gap-3 text-sm text-text-muted">
          <time datetime={post.data.date.toISOString()}>
            {post.data.date.toLocaleDateString("en-US", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })}
          </time>
          {post.data.tags.length > 0 && (
            <>
              <span>&middot;</span>
              <span>{post.data.tags[0]}</span>
            </>
          )}
        </div>
        <h2 class="text-xl font-semibold mt-2 group-hover:text-primary transition-colors">
          {post.data.title}
        </h2>
        <p class="text-text-muted text-sm mt-2">{post.data.description}</p>
      </a>
    ))}
  </div>
</BaseLayout>
